import"./modulepreload-polyfill-B5Qt9EMX.js";function b(){let e=localStorage.getItem("clientId");return e||(e="demo-user",localStorage.setItem("clientId",e)),e}const d=b(),c=document.getElementById("cart-items"),l=document.getElementById("cart-empty"),r=document.getElementById("cart-footer"),f=document.getElementById("subtotal"),i=document.getElementById("checkout-btn");async function u(){c.innerHTML="",l.style.display="none",r.style.display="none",i.disabled=!0;try{const e=await fetch(`/api/cart?clientId=${encodeURIComponent(d)}`,{credentials:"include"});if(!e.ok)throw new Error("Failed to load cart");const n=await e.json(),t=n.cart??n.items??[],o=Number(n.subtotal??v(t));if(!t.length){l.style.display="block";return}c.innerHTML=t.map(a=>{const m=a.pizzaId??a.id??"",y=a.name??"Pizza",s=Number(a.quantity??1),p=Number(a.price??0);return`
            <div class="row" data-id="${m}">
              <div class="item-name">${g(y)}</div>
              <div class="qty">x${s}</div>
              <div class="price">$${(p*s).toFixed(2)}</div>
              <button class="remove" data-action="remove">Remove</button>
            </div>
          `}).join(""),f.textContent=`$${o.toFixed(2)}`,r.style.display="flex",i.disabled=!1}catch{c.innerHTML='<div class="empty">Unable to load cart. Please try again.</div>'}}function v(e){return e.reduce((n,t)=>n+Number(t.price??0)*Number(t.quantity??1),0)}function g(e){return String(e).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}document.addEventListener("click",async e=>{const n=e.target.closest('[data-action="remove"]');if(!n)return;const t=n.closest(".row"),o=t==null?void 0:t.dataset.id;if(o){n.disabled=!0;try{if(!(await fetch("/api/cart/remove",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({clientId:d,pizzaId:o})})).ok)throw new Error("Remove failed");t.remove(),c.querySelector(".row")?await u():(l.style.display="block",r.style.display="none")}catch{n.disabled=!1,alert("Failed to remove item. Please try again.")}}});i.addEventListener("click",async()=>{alert("Proceeding to checkoutâ€¦ (wire this up to your payment flow)")});u();
